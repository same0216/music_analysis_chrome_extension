# Music BPM & Key Analyzer Chrome拡張機能

ブラウザのタブで再生中の音楽のBPM（テンポ）と音楽キーを自動分析するモダンなChrome拡張機能です。

## 機能

- 🎵 **BPM検出**: タブで再生中の音楽のテンポを自動検出
- 🎹 **キー検出**: Camelotホイール記法（8B、5Aなど）で音楽キーを識別
- 🎨 **モダンなUI**: グラデーションとスムーズなアニメーションを備えた美しいインターフェース
- 📊 **リアルタイム可視化**: 分析中の音声波形をリアルタイム表示
- ⚡ **高速分析**: 先進的な音声処理アルゴリズムにより数秒で結果を表示

## インストール方法

1. このリポジトリをクローンまたはダウンロード
2. `icons/` ディレクトリにアイコンファイルを追加:
   - icon16.png (16x16)
   - icon48.png (48x48)
   - icon128.png (128x128)
3. Chromeで `chrome://extensions/` を開く
4. 右上の「デベロッパーモード」を有効化
5. 「パッケージ化されていない拡張機能を読み込む」をクリックして、拡張機能のディレクトリを選択
6. ツールバーに拡張機能アイコンが表示されます

## 使い方

1. 音楽が再生されているウェブページ（YouTube、Spotify Web Player、SoundCloudなど）を開く
2. ツールバーの拡張機能アイコンをクリック
3. 「分析開始」ボタンをクリック
4. 数秒待つとBPMとキーの結果が表示されます

## 技術詳細

### BPM検出
拡張機能は以下のピーク検出アルゴリズムを使用します:
- アクティブなタブから音声サンプルをキャプチャ
- 音声信号のRMSエネルギーを分析
- エネルギーレベルのピークを検出
- ピーク間の中央値間隔を計算
- 範囲正規化（60-180 BPM）によりBPMに変換

### キー検出
音楽キーは以下を使用して検出されます:
- FFT（高速フーリエ変換）分析
- クロマグラム計算（12ビンのピッチクラスプロファイル）
- Krumhansl-Schmucklerキー検出アルゴリズム
- メジャーおよびマイナーキープロファイルとの相関
- Camelotホイール記法へのマッピング

### 技術スタック
- **Manifest V3**: 最新のChrome拡張機能フォーマット
- **Web Audio API**: 音声キャプチャと分析
- **Chrome Tab Capture API**: タブ音声のキャプチャ
- **バニラJavaScript**: 依存関係なし
- **CSS3**: モダンなグラデーションとアニメーション

## Camelotホイール対応表

Camelotホイールはハーモニックミキシング用の音楽記法システムです:

| キー | Camelot | キー | Camelot |
|-----|---------|-----|---------|
| C major | 8B | A minor | 8A |
| G major | 9B | E minor | 9A |
| D major | 10B | B minor | 10A |
| A major | 11B | F# minor | 11A |
| E major | 12B | C# minor | 12A |
| B major | 1B | G# minor | 1A |
| F# major | 2B | D# minor | 2A |
| Db major | 3B | Bb minor | 3A |
| Ab major | 4B | F minor | 4A |
| Eb major | 5B | C minor | 5A |
| Bb major | 6B | G minor | 6A |
| F major | 7B | D minor | 7A |

## ブラウザ互換性

- Chrome 88以降
- Edge 88以降
- Manifest V3をサポートするその他のChromiumベースのブラウザ

## 必要なパーミッション

拡張機能は以下を必要とします:
- `activeTab`: 現在のタブへのアクセス
- `tabCapture`: タブから音声をキャプチャ
- `scripting`: コンテンツスクリプトの挿入

## 制限事項

- 音声が再生されているタブでのみ動作します
- 分析中は音声が再生されている必要があります
- 一定のビートを持つ音楽で最良の結果が得られます
- 音声制限により一部のウェブサイトでは動作しない場合があります

## 開発

### ファイル構造
```
music_analysis_chrome_extension/
├── manifest.json          # 拡張機能の設定
├── popup.html            # 拡張機能ポップアップUI
├── popup.js              # ポップアップロジックとUIコントローラー
├── styles.css            # モダンなスタイリング
├── audio-analyzer.js     # BPMとキー検出アルゴリズム
├── background.js         # バックグラウンドサービスワーカー
├── content.js            # コンテンツスクリプト
├── icons/                # 拡張機能アイコン
│   ├── icon16.png
│   ├── icon48.png
│   └── icon128.png
└── README.md
```

### テスト
1. 様々な音楽ストリーミングサイトでテスト（YouTube、Spotify、SoundCloud）
2. 異なるジャンルとテンポを試す
3. 既知の曲でキー検出の精度を確認
4. UIの応答性とアニメーションを確認

## 今後の機能拡張

- [ ] 分析したトラックの履歴
- [ ] 結果をCSV/JSONにエクスポート
- [ ] 音楽データベースとの統合（Spotify API等）
- [ ] 波形分析の視覚化
- [ ] プレイリストの一括分析
- [ ] テンポ調整コントロール

## ライセンス

MIT License - 必要に応じて自由に使用および変更してください。

## クレジット

以下を使用して開発されました:
- Krumhansl-Schmucklerキー検出アルゴリズム
- Camelotホイールハーモニックミキシングシステム
- Web Audio API仕様
